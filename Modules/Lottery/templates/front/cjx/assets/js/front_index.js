var index=function(){function A(a){$(".lottery-right").html('<div class="result-line"><div class="result-num">1</div></div>');$.ajax({url:"/Modules/module.php?m=lottery&c=front&a=ajaxGetWinners",data:{activityid:configid,prizeid:a},type:"post",dataType:"json"}).done(function(a){if(0>a.code)return alert(a.message),!1;p=a.data.participants;if(0<a.data.winners.length){var c="";m=a.data.winners.length;d.leftnum=d.num-m;for(var b=0;b<m;b++){var e=a.data.winners[b];var h='<div class="result-line" style="display: block;"><div class="result-num">{{iterator}}</div><div class="user toux3" style="background-image: url(\'{{image}}\'); width: 60px; height: 60px;"><p class="nick-name">{{col1}}</p></div></div>'.replace("{{iterator}}",
m-b);h=""!=e.nick_name?h.replace("{{col1}}",""+e.nick_name):h.replace("{{col1}}","");h=void 0!=e.avatar&&""!=e.avatar?h.replace("{{image}}",e.avatar):h.replace("{{image}}","/Modules/Lottery/templates/front/cjx/assets/images/lot_nouser.jpg");c+=h}$(c).appendTo($(".lottery-right"))}})}function q(a){d=prizesdata[a];$("#prizedata").text(d.prizename);$(".lottery-img").find("img").attr("src",d.formatedtext.text);A(d.id)}function u(){e=(e+1)%r;c=1;k.text(c);q(e)}function v(){e=0>e-1?r-1:e-1;e%=r;c=1;k.text(c);
q(e)}function w(){c--;c=1>c?1:c;k.text(c)}function x(){if(0>p-c)return alert("\u5df2\u7ecf\u6ca1\u6709\u53ef\u4ee5\u53c2\u4e0e\u62bd\u5956\u7684\u4eba\u4e86\u3002"),!1;if(0>d.totalleft-c)return alert("\u5956\u54c1\u6570\u91cf\u4e0d\u591f\u4e86\uff0c\u65e0\u6cd5\u8fdb\u884c\u62bd\u5956\u3002"),!1;if(1==n)return!1;b.removeClass("btn-start").addClass("btn-stop");b.off("click");b.text("\u505c\u6b62");b.fadeOut("slow");$(".lottery-run").removeClass("moving");$(".lottery-run").addClass("box-moving");y.play();
setTimeout(function(){n=!0;b.fadeIn("slow");b.on("click",function(){B()})},2E3)}function B(){if(0>p-c)return alert("\u5df2\u7ecf\u6ca1\u6709\u53ef\u4ee5\u53c2\u4e0e\u62bd\u5956\u7684\u4eba\u4e86\u3002"),!1;if(0>d.totalleft-c)return alert("\u5956\u54c1\u6570\u91cf\u4e0d\u591f\u4e86\uff0c\u65e0\u6cd5\u8fdb\u884c\u62bd\u5956\u3002"),!1;if(0==n)return!1;b.removeClass("btn-stop").addClass("btn-start");b.off("click");b.text("\u5f00\u59cb\u62bd\u5956");b.fadeOut("slow");$.ajax({url:"/Modules/module.php?m=lottery&c=front&a=ajaxGetLotteryResult",
data:{activityid:configid,prizeid:d.id,num:c},type:"post",dataType:"json"}).done(function(a){0<a.code?(t=t.concat(a.data),d.totalleft-=a.data.length,y.pause(),$(".lottery-run").removeClass("box-moving"),C(),b.on("click",function(){x()})):(alert(a.message),window.location.reload())})}function C(){z(t,function(){b.fadeIn("slow");n=!1})}function z(a,c){if(0>=a.length)c();else{$(".lottery-run").addClass("moving");var b=a.pop();f.css({"background-image":"url("+b.avatar+")"});f.find(".nick-name").text(b.nick_name);
D.play();$(".lottery-right").scrollTop(0);b=$(".lottery-right").scroll(0).children(".result-line").length;var e=$ResultSeed.clone();e.find(".result-num").html(b);e.prependTo(".lottery-right").slideDown();var d=e.offset();window.setTimeout(function(){window.setTimeout(function(){$(".lottery-run").removeClass("moving")},500);var b=f.clone().appendTo("body").css({position:"absolute",top:f.offset().top,left:f.offset().left,width:f.width(),height:f.height()}).addClass("").animate({width:60,height:60,top:d.top+
5,left:d.left+50},500,function(){var d=b.css("background-image");b.appendTo(e).removeAttr("style").css({"background-image":d});z(a,c)})},3E3)}}function E(){F.on("click",function(){v()});G.on("click",function(){u()});H.on("click",function(){w()});I.on("click",function(){c++;k.text(c)});b.on("click",function(){x()})}function J(){hotkeys("up",function(a){c++;k.text(c)});hotkeys("down",function(a){w()});hotkeys("left",function(a){v()});hotkeys("right",function(a){u()});hotkeys("space",function(a){b.trigger("click")})}
var y=document.getElementById("Audio_Running"),D=document.getElementById("Audio_Result"),l=$(".lottery-side"),K=$(".lottery-bottom"),F=l.find(".btn-left"),G=l.find(".btn-right"),H=l.find(".icon-minus"),I=l.find(".icon-plus"),k=l.find(".lottery-num"),b=K.find(".btn-start"),f=$(".lottery-run .user"),g=lotteryconfig.themeconfig,c=0,e=0,d=null,r=prizesdata.length,m=0,p=0,n=!1,t=[];$ResultSeed=$(".lottery-right .result-line");return{init:function(){if(0>=prizesdata.length)alert("\u8bf7\u5148\u5728\u540e\u53f0\u6dfb\u52a0\u5956\u9879,\u7136\u540e\u5237\u65b0\u9875\u9762\u54e6!");
else{for(var a=0,b=prizesdata.length;a<b;a++)prizesdata[a].totalleft=parseInt(prizesdata[a].leftnum)+parseInt(prizesdata[a].freezenum);c=parseInt(k.text());q(e)}E();J();$(".prizename .iconfont").css({color:g.fontcolor});$(".lottery-control .control-item").css({color:g.fontcolor});$("#prizedata").css({color:g.prizefontcolor});$(".result-line .nick-name").css({color:g.winnerfontcolor});$(".setting-border,.lottery-control").css({"background-color":g.leftcolor});window.sessionStorage.bgpath=g.bg_path;
window.sessionStorage.bgmusic=g.bgmusic_path+"|"+g.bgmusic_switch;if(0<lotteryconfigs.length){a=[];b=["","icon3dcj","iconzjd","iconcjx"];for(var d=0,f=lotteryconfigs.length;d<f;d++)a[d]={name:lotteryconfigs[d].title,action:"/Modules/module.php?m=lottery&c=front&a=index&id="+lotteryconfigs[d].id,icon:b[lotteryconfigs[d].themeid],current:configid==lotteryconfigs[d].id?1:2};window.top.roundbar().init(a)}}}}();$(document).ready(function(){index.init()});