var index=function(){function A(a){$(".lottery-right").html('<div class="result-line"><div class="result-num">1</div></div>');$.ajax({url:"/Modules/module.php?m=lottery&c=front&a=ajaxGetWinners",data:{activityid:configid,prizeid:a},type:"post",dataType:"json"}).done(function(a){if(0>a.code)return alert(a.message),!1;u=a.data.participants;if(0<a.data.winners.length){var c="";n=a.data.winners.length;d.leftnum=d.num-n;for(var f=0;f<n;f++){var b=a.data.winners[f];var h='<div class="result-line" style="display: block;"><div class="result-num">{{iterator}}</div><div class="user toux3" style="background-image: url(\'{{image}}\'); width: 60px; height: 60px;"><p class="nick-name">{{col1}}</p></div></div>'.replace("{{iterator}}",
n-f);h=""!=b.nick_name?h.replace("{{col1}}",""+b.nick_name):h.replace("{{col1}}","");h=void 0!=b.avatar&&""!=b.avatar?h.replace("{{image}}",b.avatar):h.replace("{{image}}","/Modules/Lottery/templates/front/cjx/assets/images/lot_nouser.jpg");c+=h}$(c).appendTo($(".lottery-right"));$(".result-line").css({"background-color":g.winnercolor})}})}function p(a){d=prizesdata[a];$("#prizedata").text(d.prizename);$(".lottery-img").find("img").attr("src",d.formatedtext.text);A(d.id)}function v(){b=(b+1)%q;c=
1;l.text(c);p(b)}function w(){b=0>b-1?q-1:b-1;b%=q;c=1;l.text(c);p(b)}function x(){c--;c=1>c?1:c;l.text(c)}function y(){if(0>u-c)return alert("\u5df2\u7ecf\u6ca1\u6709\u53ef\u4ee5\u53c2\u4e0e\u62bd\u5956\u7684\u4eba\u4e86\u3002"),!1;if(0>d.totalleft-c)return alert("\u5956\u54c1\u6570\u91cf\u4e0d\u591f\u4e86\uff0c\u65e0\u6cd5\u8fdb\u884c\u62bd\u5956\u3002"),!1;if(0==r)return!1;r=!1;e.removeClass("btn-stop").addClass("btn-start");e.off("click");e.fadeOut("slow");$.ajax({url:"/Modules/module.php?m=lottery&c=front&a=ajaxGetLotteryResult",
data:{activityid:configid,prizeid:d.id,num:c},type:"post",dataType:"json"}).done(function(a){0<a.code?(t=t.concat(a.data),d.totalleft-=a.data.length,B.pause(),$(".lottery-run").removeClass("box-moving"),C(),e.on("click",function(){y()})):(alert(a.message),window.location.reload())})}function C(){z(t,function(){e.fadeIn("slow");r=!0})}function z(a,c){if(0>=a.length)c();else{$(".lottery-run").addClass("moving");var b=a.shift();k.css({"background-image":"url("+b.avatar+")"});k.find(".nick-name").text(b.nick_name);
D.play();$(".lottery-right").scrollTop(0);b=$(".lottery-right").scroll(0).children(".result-line").length;var f=$ResultSeed.clone();f.find(".result-num").html(b);f.prependTo(".lottery-right").slideDown();$(".result-line").css({"background-color":g.winnercolor});var d=f.offset();window.setTimeout(function(){window.setTimeout(function(){$(".lottery-run").removeClass("moving")},500);var b=k.clone().appendTo("body").css({position:"absolute",top:k.offset().top,left:k.offset().left,width:k.width(),height:k.height()}).addClass("").animate({width:60,
height:60,top:d.top+5,left:d.left+50},500,function(){var d=b.css("background-image");b.appendTo(f).removeAttr("style").css({"background-image":d});z(a,c)})},3E3)}}function E(){F.on("click",function(){w()});G.on("click",function(){v()});H.on("click",function(){x()});I.on("click",function(){c++;l.text(c)});e.on("click",function(){y()})}function J(){hotkeys("up",function(a){c++;l.text(c)});hotkeys("down",function(a){x()});hotkeys("left",function(a){w()});hotkeys("right",function(a){v()});hotkeys("space",
function(a){e.trigger("click")})}var B=document.getElementById("Audio_Running"),D=document.getElementById("Audio_Result"),m=$(".lottery-side"),K=$(".lottery-bottom"),F=m.find(".btn-left"),G=m.find(".btn-right"),H=m.find(".icon-minus"),I=m.find(".icon-plus"),l=m.find(".lottery-num"),e=K.find(".btn-start"),k=$(".lottery-run .user"),c=0,b=0,d=null,q=prizesdata.length,n=0,u=0,g=lotteryconfig.themeconfig,r=!0,t=[];$ResultSeed=$(".lottery-right .result-line");return{init:function(){if(0>=prizesdata.length)alert("\u8bf7\u5148\u5728\u540e\u53f0\u6dfb\u52a0\u5956\u9879,\u7136\u540e\u5237\u65b0\u9875\u9762\u54e6!");
else{for(var a=0,d=prizesdata.length;a<d;a++)prizesdata[a].totalleft=parseInt(prizesdata[a].leftnum)+parseInt(prizesdata[a].freezenum);c=parseInt(l.text());p(b)}E();J();$(".prizename .iconfont").css({color:g.fontcolor});$(".lottery-control .control-item").css({color:g.fontcolor});$("#prizedata").css({color:g.prizefontcolor});$(".result-line .nick-name").css({color:g.winnerfontcolor});$(".setting-border,.lottery-control").css({"background-color":g.leftcolor});window.sessionStorage.bgpath=g.bg_path;
window.sessionStorage.bgmusic=g.bgmusic_path+"|"+g.bgmusic_switch;if(0<lotteryconfigs.length){a=[];d=["","icon3dcj","iconzjd","iconcjx"];for(var e=0,f=lotteryconfigs.length;e<f;e++)a[e]={name:lotteryconfigs[e].title,action:"/Modules/module.php?m=lottery&c=front&a=index&id="+lotteryconfigs[e].id,icon:d[lotteryconfigs[e].themeid],current:configid==lotteryconfigs[e].id?1:2};window.top.roundbar().init(a)}}}}();$(document).ready(function(){index.init()});